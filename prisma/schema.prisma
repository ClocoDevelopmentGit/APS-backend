generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// TERM MODEL
// ============================================
model Term {
  id        String   @id @default(uuid())
  name      String   @db.VarChar(100)
  startDate DateTime @db.Date
  endDate   DateTime @db.Date
  isActive  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?  @db.VarChar(255)
  updatedBy String?  @db.VarChar(255)

  // Relations
  classes Class[]

  @@index([isActive])
  @@index([startDate, endDate])
}

// ============================================
// LOCATION MODEL (UPDATED)
// ============================================
model Location {
  id           String   @id @default(uuid())
  name         String   @db.VarChar(200)
  addressLine1 String   @db.VarChar(500)
  addressLine2 String?  @db.VarChar(500)
  suburb       String   @db.VarChar(200)
  city         String   @db.VarChar(200)
  state        String   @db.VarChar(100)
  country      String   @default("Australia") @db.VarChar(100)
  postcode     String?  @db.VarChar(20)
  rooms        String[] @db.VarChar(100)    // non-nullable array (must be provided)
  notes        String?   @db.Text @default("")           
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  createdBy    String?  @db.VarChar(255)
  updatedBy    String?  @db.VarChar(255)

  // Relations
  classes Class[]
  events  Event[]

  @@index([isActive])
}

// ============================================
// Course CATEGORY MODEL (NEW / FIXED)
// ============================================
model CourseCategory {
  id          String   @id @default(uuid())
  name        String   @db.VarChar(100)
  description String?  @db.Text
  ageRange    String?  @db.VarChar(50)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?  @db.VarChar(255)
  updatedBy   String?  @db.VarChar(255)

  // Relations
  courses Course[]

  @@index([isActive])
}

// ============================================
// Course MODEL (UPDATED)
// ============================================
model Course {
  id               String   @id @default(uuid())
  title            String   @db.VarChar(255)
  description      String?  @db.Text
  isActive         Boolean  @default(true)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  createdBy        String?  @db.VarChar(255)
  updatedBy        String?  @db.VarChar(255)
  courseCategoryId String   // removed default — must be set explicitly

  // Relations
  classes        Class[]
  courseCategory CourseCategory @relation(fields: [courseCategoryId], references: [id])

  @@index([id])
}

// ============================================
// Class MODEL (UPDATED)
// ============================================
model Class {
  id             String   @id @default(uuid())
  courseId       String   // removed default — must be set explicitly
  termId         String   // removed default
  locationId     String   // made NON-NULLABLE and removed default
  tutorId        String   // removed default
  day            String   @db.VarChar(20)
  startDate      DateTime @db.Date
  endDate        DateTime @db.Date
  startTime      DateTime @db.Time
  endTime        DateTime @db.Time
  timezone       String   @default("Australia/Melbourne") @db.VarChar(50)
  room           String  @db.VarChar(100)
  notes          String?  @db.Text
  availableSeats Int
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  createdBy      String?  @db.VarChar(255)
  updatedBy      String?  @db.VarChar(255)

  // Relations
  course   Course    @relation(fields: [courseId], references: [id], onDelete: Restrict)
  term     Term      @relation(fields: [termId], references: [id], onDelete: Restrict)
  location Location  @relation(fields: [locationId], references: [id], onDelete: Restrict)
  fees     Fee[]
  tutor    User      @relation(fields: [tutorId], references: [id], onDelete: Restrict)

  @@index([courseId])
  @@index([termId])
  @@index([locationId])
  @@index([day])
  @@index([startDate])
  @@index([endDate])
  @@index([isActive])
}

// ============================================
// FEE MODEL
// ============================================
model Fee {
  id        String   @id @default(uuid())
  termFee   Decimal  @db.Decimal(10, 2)
  yearlyFee Decimal  @db.Decimal(10, 2)
  classId   String   // removed default
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  createdBy String?  @db.VarChar(255)
  updatedBy String?  @db.VarChar(255)

  // Relations
  class Class @relation(fields: [classId], references: [id], onDelete: Cascade)

  @@index([classId])
}

// ============================================
// EVENT MODEL (UPDATED)
// ============================================
model Event {
  id             String   @id @default(uuid())
  locationId     String   // made NON-NULLABLE and removed default
  title          String   @db.VarChar(255)
  description    String?  @db.Text
  canEnroll      Boolean  @default(false) // default changed to false
  startDate      DateTime @db.Date
  endDate        DateTime @db.Date
  startTime      DateTime @db.Time
  endTime        DateTime @db.Time
  timezone       String   @default("Australia/Melbourne") @db.VarChar(50)
  room           String  @db.VarChar(100)
  notes          String?  @db.Text
  availableSeats Int
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  createdBy      String?  @db.VarChar(255)
  updatedBy      String?  @db.VarChar(255)
  fees           Float

  // Relations
  location Location @relation(fields: [locationId], references: [id], onDelete: Restrict)

  @@index([locationId])
  @@index([canEnroll])
  @@index([startDate])
  @@index([endDate])
  @@index([isActive])
}

// ============================================
// USER MODEL (UPDATED)
// ============================================
model User {
  id             String    @id @default(uuid())
  userId         String    @unique
  firstName      String    @db.VarChar(255)
  lastName       String    @db.VarChar(255)
  email          String    @unique @db.VarChar(255)
  phone          String    @db.VarChar(20)   
  dob            DateTime  @db.Date         
  gender         Gender
  details        String?   @db.Text
  specialNeeds   Boolean
  password       String    @db.VarChar(255)
  role           UserRole  // use enum field (removed roleId string FK)
  specialization String[]
  guardianId     String?                       // removed default; optional (NULL when no guardian)
  photoPath      String?   @db.VarChar(500)
  isActive       Boolean   @default(true)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt
  createdBy      String?   @db.VarChar(255)
  updatedBy      String?   @db.VarChar(255)

  // Relations
  guardian      User?   @relation("UserGuardian", fields: [guardianId], references: [id], onDelete: SetNull)
  dependents    User[]  @relation("UserGuardian")
  taughtClasses Class[]

  @@index([email])
  @@index([guardianId])
  @@index([isActive])
  @@index([role])
}
model Banner {
  id              String  @id @default(uuid())
  order           Int
  mediaUrl        String
  mediaType       String
  title           String
  subtitle        String?
  button1Text     String?
  button1Link     String?
  button2Text     String?
  button2Link     String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdBy       String?  @db.VarChar(255)
  updatedBy       String?  @db.VarChar(255)
}

enum Gender {
  Male
  Female
}

enum UserRole {
  Admin
  Tutor
  Student
  Parent
}


